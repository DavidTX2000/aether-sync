#!/data/data/com.termux/files/usr/bin/bash
# AETHER-SYNC v6.4.0 - DavidTX2000

SHADOW="/data/data/com.termux/files/usr/share/aether/shadow"
BLUE="\033[1;34m"
CYAN="\033[1;36m"
YELLOW="\033[1;33m"
GREEN="\033[1;32m"
RED="\033[1;31m"
RESET="\033[0m"

# Mock APK List for Parallel Space
APPS_LIST=("Aether Archives")

get_free_space() { df -h /data | awk 'NR==2 {print $4}' | sed 's/G//' | cut -d. -f1; }

parallel_space() {
    # Check if inside Aether environment
    if [[ "$PWD" != *"$SHADOW"* ]]; then
        echo -e "${RED}Error: --parallel_space only works inside the Aether environment!${RESET}"
        exit 1
    fi

    echo -e "${BLUE}Do you want to add an APK file to the space? (yes/no):${RESET} "
    read choice
    if [[ "$choice" == "yes" ]]; then
        echo -e "${BLUE}Type the APK path (or paths separated by space):${RESET} "
        read -a paths
        for p in "${paths[@]}"; do
            if [ -f "$p" ]; then
                echo -e "${GREEN}[CHECKING] $p... Functional and Installable.${RESET}"
                APPS_LIST+=("$(basename "$p")")
            else
                echo -e "${RED}[ERROR] $p not found.${RESET}"
            fi
        done
    fi

    echo -e "${BLUE}Background color (name or hex):${RESET} "
    read bg_color
    
    # Render Menu
    clear
    echo -e "${YELLOW}"
    echo "          WELCOME TO THE"
    echo "   AETHER-SYNC PARALLEL SPACE"
    echo -e "----------------------------------${RESET}"
    echo -e "Theme: $bg_color | Press CTRL+C to Exit"
    echo ""
    
    for i in "${!APPS_LIST[@]}"; do
        if [[ "${APPS_LIST[$i]}" == "Aether Archives" ]]; then
            echo -e " [$i] ðŸ“‚ ${APPS_LIST[$i]} (System Default)"
        else
            echo -e " [$i] ðŸ“¦ ${APPS_LIST[$i]}"
        fi
    done
    echo ""
    
    echo -e "${CYAN}Select an app to open (or wait):${RESET}"
    # MantÃ©m o menu aberto atÃ© CTRL+C
    trap 'echo -e "\n${BLUE}Exiting Parallel Space...${RESET}"; exit' INT
    while true; do sleep 1; done
}

morph() {
    FREE=$(get_free_space)
    [ "$FREE" -le 4 ] && echo -e "${YELLOW}Warning: Please do not delete the cache and data using aether --kill, as we are in the emulation process. Low storage detected ($FREE GB).${RESET}"
    
    # ... (LÃ³gica de clonagem anterior mantida) ...
    ROOT_PATHS=("/acct" "/apex" "/bin" "/cache" "/config" "/data" "/dev" "/etc" "/mnt" "/odm" "/oem" "/proc" "/product" "/sdcard" "/storage" "/sys" "/system" "/system_ext" "/vendor")
    for p in "${ROOT_PATHS[@]}"; do
        if [ -d "$p" ]; then
            mkdir -p "$SHADOW$p"
            cp -as "$p"/. "$SHADOW$p/" 2>/dev/null
        fi
    done

    cat <<OP > "$SHADOW/.bashrc"
export PS1='~#aether\${PWD#$SHADOW}\$: '
alias aether='/data/data/com.termux/files/usr/bin/aether'
alias ls='ls --color=auto -F'
echo -e "${GREEN}Aether-Sync Global Environment Active.${RESET}"
OP
    cd "$SHADOW"
    exec bash --rcfile "$SHADOW/.bashrc" -i
}

case "$1" in
    --morph) morph ;;
    --parallel_space) parallel_space ;;
    --kill) rm -rf "$SHADOW"/* ;;
    *) echo "Usage: aether [--morph|--parallel_space|--kill]" ;;
esac
